{% load static %}

<link rel="stylesheet" href="{% static 'css/teacher/teacher_header.css' %}">

<header class="topbar">
  <div class="user-info">
    <a href="{% url 'teacher_profile' %}" style="display:flex;align-items:center;text-decoration:none;">
      <img
        src="{% if teacher_profile_image %}{{ MEDIA_URL }}{{ teacher_profile_image }}{% else %}{% static 'img/admin-icon.png' %}{% endif %}"
        alt="Teacher Image"
        class="admin-icon"
        style="width:44px;height:44px;border-radius:50%;object-fit:cover;"
      />
      <span style="color:#333">{{ teacher_name }}</span>
    </a>
  </div>

  <div class="notif-wrapper">
    <span class="notif-icon" id="notifToggle" title="Notifications">ðŸ””
      {% if unread_count > 0 %}<span class="notif-badge">{{ unread_count }}</span>{% endif %}
    </span>
  </div>
</header>

<!-- Fixed dropdown (doesn't affect header height) -->
<div class="notif-dropdown collapsed" id="notifDropdown" aria-hidden="true">
  <div class="notif-header">
    <span>Notifications</span>
  </div>

  {% if notifications %}
    <div class="notif-body" id="notifBody">
      <ul class="notif-list" id="notifList">
        {% for notif in notifications %}
          <li class="notif-item {% if notif.status == 'Unread' %}unread{% endif %}" data-id="{{ notif.id }}">
            <div class="notif-row">
              <span class="dot"></span>
              <div class="content">
                <p class="message">{{ notif.message|default:"(No message)" }}</p>
                <small class="timestamp">{{ notif.created_at|date:"M d, Y H:i" }}</small>
              </div>
              <span class="chev" aria-hidden="true">â€º</span>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>

    <div class="notif-footer">
      <div class="footer-actions">
        <button id="toggleCollapseBtn" class="btn-primary">See more</button>
      </div>
    </div>
  {% else %}
    <p class="no-notifs">No notifications.</p>
  {% endif %}
</div>

<!-- Modal: window-style (closing this won't close the dropdown) -->
<div id="notifModal" class="notif-modal" aria-hidden="true">
  <div class="notif-window" id="notifWindow">
    <div class="titlebar">
      <span class="title">Notification</span>
      <button class="titlebar-close" id="closeModalBtn" aria-label="Close">Ã—</button>
    </div>
    <div class="window-body">
 
      <p id="notifFullMessage" class="body-text"></p>
    </div>
  </div>
</div>

<!-- URLs for JS -->
<script>
  window.NOTIF = {
    markReadUrl: "{% url 'mark_notifications_read' %}",
    detailUrlTemplate: "{% url 'notification_detail' 0 %}"
  };

  // === PUSHER GLOBALS FOR TEACHER ===
  window.PUSHER_KEY = "{{ PUSHER_KEY|default:'' }}";
  window.PUSHER_CLUSTER = "{{ PUSHER_CLUSTER|default:'' }}";
  window.CURRENT_TEACHER_ID = "{{ request.session.user_id|default:'' }}";
  window.CURRENT_ADMIN_ID = "";  // ensure admin channel not used here
</script>

<!-- PUSHER + SHARED REALTIME JS -->
<script src="https://js.pusher.com/8.4.0/pusher.min.js"></script>
<script src="{% static 'js/pusher.js' %}"></script>

<!-- Existing header behavior -->
<script src="{% static 'js/teacher_header.js' %}"></script>
